import { ComponentFixture, TestBed } from '@angular/core/testing';
import { RouterTestingModule } from '@angular/router/testing';
import { RatesChartsComponent } from './rates-charts.component';
import { anything, instance, mock, when } from 'ts-mockito';
import { of } from 'rxjs';
import { ChartsFacade } from 'app-core/facades/charts.facade';
import { BaseChart, Chart } from 'app-core/models/chart.model';
import { NgxEchartsModule } from 'ngx-echarts';

describe('Rates Charts Component', () => {
  let fixture: ComponentFixture<RatesChartsComponent>;
  let component: RatesChartsComponent;
  let element: HTMLElement;
  let chartsFacade: ChartsFacade;

  beforeEach(async () => {
    chartsFacade = mock(ChartsFacade);
    chartsFacade.getChart(anything());
    const chartsData: BaseChart[] = [
      {
        time: '2022.11.30 00:00',
        open: 143.102,
        low: 143.08,
        high: 144.84,
        close: 143.603,
        volume: 284051,
      },
      {
        time: '2022.12.01 00:00',
        open: 143.596,
        low: 141.895,
        high: 143.754,
        close: 142.187,
        volume: 332263,
      },
      {
        time: '2022.12.02 00:00',
        open: 142.205,
        low: 140.755,
        high: 142.473,
        close: 141.541,
        volume: 300427,
      },
      {
        time: '2022.12.05 00:00',
        open: 141.458,
        low: 141.449,
        high: 143.612,
        close: 143.27,
        volume: 233380,
      },
      {
        time: '2022.12.06 00:00',
        open: 143.267,
        low: 143.088,
        high: 143.992,
        close: 143.306,
        volume: 252637,
      },
      {
        time: '2022.12.07 00:00',
        open: 143.236,
        low: 143.158,
        high: 144.576,
        close: 143.492,
        volume: 262342,
      },
      {
        time: '2022.12.08 00:00',
        open: 143.569,
        low: 143.24,
        high: 144.356,
        close: 144.137,
        volume: 209397,
      },
      {
        time: '2022.12.09 00:00',
        open: 144.179,
        low: 143.146,
        high: 144.464,
        close: 143.84,
        volume: 251600,
      },
      {
        time: '2022.12.12 00:00',
        open: 143.562,
        low: 143.562,
        high: 145.094,
        close: 144.994,
        volume: 187826,
      },
      {
        time: '2022.12.13 00:00',
        open: 144.967,
        low: 143.513,
        high: 145.338,
        close: 144.128,
        volume: 293028,
      },
      {
        time: '2022.12.14 00:00',
        open: 144.119,
        low: 143.473,
        high: 144.742,
        close: 144.695,
        volume: 313397,
      },
      {
        time: '2022.12.15 00:00',
        open: 144.695,
        low: 144.297,
        high: 146.722,
        close: 146.398,
        volume: 287995,
      },
      {
        time: '2022.12.16 00:00',
        open: 146.369,
        low: 144.594,
        high: 146.593,
        close: 144.604,
        volume: 244120,
      },
      {
        time: '2022.12.19 00:00',
        open: 143.753,
        low: 143.739,
        high: 145.485,
        close: 145.181,
        volume: 244800,
      },
      {
        time: '2022.12.20 00:00',
        open: 145.181,
        low: 138.795,
        high: 145.829,
        close: 139.924,
        volume: 472414,
      },
      {
        time: '2022.12.21 00:00',
        open: 139.873,
        low: 139.64,
        high: 140.763,
        close: 140.458,
        volume: 277435,
      },
      {
        time: '2022.12.22 00:00',
        open: 140.458,
        low: 139.953,
        high: 140.654,
        close: 140.156,
        volume: 235127,
      },
      {
        time: '2022.12.23 00:00',
        open: 140.142,
        low: 140.063,
        high: 141.206,
        close: 140.924,
        volume: 219216,
      },
      {
        time: '2022.12.26 00:00',
        open: 140.661,
        low: 140.655,
        high: 141.478,
        close: 141.2,
        volume: 71146,
      },
      {
        time: '2022.12.27 00:00',
        open: 141.222,
        low: 141.126,
        high: 142.265,
        close: 142.01,
        volume: 199724,
      },
      {
        time: '2022.12.28 00:00',
        open: 142.01,
        low: 141.852,
        high: 142.938,
        close: 142.676,
        volume: 228991,
      },
      {
        time: '2022.12.29 00:00',
        open: 142.725,
        low: 141.567,
        high: 142.749,
        close: 141.805,
        volume: 222923,
      },
      {
        time: '2022.12.30 00:00',
        open: 141.814,
        low: 139.988,
        high: 141.897,
        close: 140.33,
        volume: 294137,
      },
      {
        time: '2023.01.02 00:00',
        open: 139.959,
        low: 139.193,
        high: 140.254,
        close: 139.37,
        volume: 143956,
      },
      {
        time: '2023.01.03 00:00',
        open: 139.385,
        low: 137.376,
        high: 140.007,
        close: 138.166,
        volume: 456673,
      },
      {
        time: '2023.01.04 00:00',
        open: 138.113,
        low: 137.868,
        high: 140.75,
        close: 140.564,
        volume: 446731,
      },
      {
        time: '2023.01.05 00:00',
        open: 140.479,
        low: 139.956,
        high: 141.353,
        close: 140.342,
        volume: 463714,
      },
      {
        time: '2023.01.06 00:00',
        open: 140.286,
        low: 140.218,
        high: 141.44,
        close: 140.554,
        volume: 477734,
      },
      {
        time: '2023.01.09 00:00',
        open: 140.303,
        low: 140.155,
        high: 141.908,
        close: 141.482,
        volume: 437170,
      },
      {
        time: '2023.01.10 00:00',
        open: 141.434,
        low: 141.079,
        high: 142.042,
        close: 141.902,
        volume: 437451,
      },
      {
        time: '2023.01.11 00:00',
        open: 141.721,
        low: 141.707,
        high: 142.847,
        close: 142.357,
        volume: 364040,
      },
      {
        time: '2023.01.12 00:00',
        open: 142.497,
        low: 140.002,
        high: 142.5,
        close: 140.179,
        volume: 493650,
      },
      {
        time: '2023.01.13 00:00',
        open: 140.03,
        low: 138.002,
        high: 140.382,
        close: 138.468,
        volume: 466390,
      },
      {
        time: '2023.01.16 00:00',
        open: 138.243,
        low: 138.176,
        high: 139.286,
        close: 139.004,
        volume: 331646,
      },
      {
        time: '2023.01.17 00:00',
        open: 138.997,
        low: 138.145,
        high: 139.609,
        close: 138.145,
        volume: 409995,
      },
      {
        time: '2023.01.18 00:00',
        open: 138.138,
        low: 138.068,
        high: 141.675,
        close: 139.059,
        volume: 565719,
      },
      {
        time: '2023.01.19 00:00',
        open: 139.059,
        low: 137.904,
        high: 139.415,
        close: 139.059,
        volume: 429772,
      },
      {
        time: '2023.01.20 00:00',
        open: 139.041,
        low: 138.955,
        high: 141.186,
        close: 140.614,
        volume: 388891,
      },
      {
        time: '2023.01.23 00:00',
        open: 140.695,
        low: 140.456,
        high: 142.07,
        close: 142.023,
        volume: 400658,
      },
      {
        time: '2023.01.24 00:00',
        open: 141.978,
        low: 141.245,
        high: 142.193,
        close: 141.674,
        volume: 341261,
      },
      {
        time: '2023.01.25 00:00',
        open: 141.674,
        low: 140.747,
        high: 142.283,
        close: 141.325,
        volume: 363379,
      },
      {
        time: '2023.01.26 00:00',
        open: 141.301,
        low: 140.862,
        high: 141.902,
        close: 141.817,
        volume: 376100,
      },
      {
        time: '2023.01.27 00:00',
        open: 141.817,
        low: 140.809,
        high: 141.817,
        close: 141.121,
        volume: 364465,
      },
      {
        time: '2023.01.30 00:00',
        open: 140.891,
        low: 140.54,
        high: 141.966,
        close: 141.397,
        volume: 384805,
      },
      {
        time: '2023.01.31 00:00',
        open: 141.396,
        low: 140.731,
        high: 141.604,
        close: 141.241,
        volume: 352898,
      },
      {
        time: '2023.02.01 00:00',
        open: 141.209,
        low: 140.848,
        high: 141.825,
        close: 141.598,
        volume: 366118,
      },
      {
        time: '2023.02.02 00:00',
        open: 141.575,
        low: 140.074,
        high: 141.925,
        close: 140.374,
        volume: 409901,
      },
      {
        time: '2023.02.03 00:00',
        open: 140.364,
        low: 139.921,
        high: 142.336,
        close: 141.603,
        volume: 331787,
      },
      {
        time: '2023.02.06 00:00',
        open: 142.75,
        low: 141.968,
        high: 142.806,
        close: 142.228,
        volume: 323339,
      },
      {
        time: '2023.02.07 00:00',
        open: 142.251,
        low: 140.276,
        high: 142.327,
        close: 140.445,
        volume: 397099,
      },
      {
        time: '2023.02.08 00:00',
        open: 140.517,
        low: 140.28,
        high: 141.018,
        close: 140.637,
        volume: 300512,
      },
      {
        time: '2023.02.09 00:00',
        open: 140.589,
        low: 140.429,
        high: 141.322,
        close: 141.21,
        volume: 356512,
      },
      {
        time: '2023.02.10 00:00',
        open: 141.236,
        low: 139.539,
        high: 141.5,
        close: 140.317,
        volume: 429286,
      },
      {
        time: '2023.02.13 00:00',
        open: 140.155,
        low: 140.121,
        high: 142.376,
        close: 141.873,
        volume: 316667,
      },
      {
        time: '2023.02.14 00:00',
        open: 141.976,
        low: 141.506,
        high: 142.936,
        close: 142.88,
        volume: 407108,
      },
      {
        time: '2023.02.15 00:00',
        open: 142.88,
        low: 142.335,
        high: 143.428,
        close: 143.357,
        volume: 347455,
      },
      {
        time: '2023.02.16 00:00',
        open: 143.345,
        low: 142.845,
        high: 143.433,
        close: 142.934,
        volume: 367817,
      },
      {
        time: '2023.02.17 00:00',
        open: 142.93,
        low: 142.851,
        high: 143.665,
        close: 143.435,
        volume: 361500,
      },
      {
        time: '2023.02.20 00:00',
        open: 143.193,
        low: 143.019,
        high: 143.645,
        close: 143.367,
        volume: 277724,
      },
      {
        time: '2023.02.21 00:00',
        open: 143.345,
        low: 143.16,
        high: 144.156,
        close: 143.708,
        volume: 352855,
      },
      {
        time: '2023.02.22 00:00',
        open: 143.771,
        low: 143.034,
        high: 143.88,
        close: 143.055,
        volume: 345709,
      },
      {
        time: '2023.02.23 00:00',
        open: 143.045,
        low: 142.553,
        high: 143.508,
        close: 142.682,
        volume: 288447,
      },
      {
        time: '2023.02.24 00:00',
        open: 142.688,
        low: 142.143,
        high: 144.001,
        close: 143.894,
        volume: 406143,
      },
      {
        time: '2023.02.27 00:00',
        open: 143.892,
        low: 143.556,
        high: 144.54,
        close: 144.383,
        volume: 329998,
      },
      {
        time: '2023.02.28 00:00',
        open: 144.363,
        low: 143.868,
        high: 145.463,
        close: 143.992,
        volume: 351582,
      },
      {
        time: '2023.03.01 00:00',
        open: 143.992,
        low: 143.946,
        high: 145.349,
        close: 145.268,
        volume: 323678,
      },
      {
        time: '2023.03.02 00:00',
        open: 145.268,
        low: 144.765,
        high: 145.56,
        close: 144.917,
        volume: 324317,
      },
      {
        time: '2023.03.03 00:00',
        open: 144.916,
        low: 144.285,
        high: 145.034,
        close: 144.434,
        volume: 286030,
      },
      {
        time: '2023.03.06 00:00',
        open: 144.414,
        low: 144.106,
        high: 145.373,
        close: 145.114,
        volume: 290597,
      },
      {
        time: '2023.03.07 00:00',
        open: 145.098,
        low: 144.551,
        high: 145.432,
        close: 144.673,
        volume: 306182,
      },
      {
        time: '2023.03.08 00:00',
        open: 144.658,
        low: 144.229,
        high: 145.226,
        close: 144.794,
        volume: 305053,
      },
      {
        time: '2023.03.09 00:00',
        open: 144.792,
        low: 143.613,
        high: 144.825,
        close: 144.055,
        volume: 280028,
      },
      {
        time: '2023.03.10 00:00',
        open: 144.055,
        low: 143.341,
        high: 145.101,
        close: 143.581,
        volume: 444911,
      },
      {
        time: '2023.03.13 00:00',
        open: 143.071,
        low: 141.361,
        high: 144.38,
        close: 142.868,
        volume: 594227,
      },
      {
        time: '2023.03.14 00:00',
        open: 142.868,
        low: 142.525,
        high: 144.402,
        close: 144.055,
        volume: 462048,
      },
      {
        time: '2023.03.15 00:00',
        open: 144.055,
        low: 139.47,
        high: 144.956,
        close: 140.995,
        volume: 547937,
      },
      {
        time: '2023.03.16 00:00',
        open: 140.997,
        low: 139.111,
        high: 141.995,
        close: 141.759,
        volume: 485471,
      },
      {
        time: '2023.03.17 00:00',
        open: 141.759,
        low: 140.149,
        high: 142.218,
        close: 140.659,
        volume: 434975,
      },
      {
        time: '2023.03.20 00:00',
        open: 140.718,
        low: 138.816,
        high: 141.74,
        close: 140.733,
        volume: 518843,
      },
      {
        time: '2023.03.21 00:00',
        open: 140.707,
        low: 140.412,
        high: 142.785,
        close: 142.592,
        volume: 377812,
      },
      {
        time: '2023.03.22 00:00',
        open: 142.588,
        low: 142.294,
        high: 143.619,
        close: 142.661,
        volume: 339861,
      },
      {
        time: '2023.03.23 00:00',
        open: 142.661,
        low: 141.149,
        high: 143.189,
        close: 141.693,
        volume: 445156,
      },
      {
        time: '2023.03.24 00:00',
        open: 141.699,
        low: 139.058,
        high: 141.835,
        close: 140.627,
        volume: 450817,
      },
      {
        time: '2023.03.27 00:00',
        open: 140.606,
        low: 140.499,
        high: 142.213,
        close: 142.018,
        volume: 330182,
      },
      {
        time: '2023.03.28 00:00',
        open: 141.996,
        low: 141.037,
        high: 142.144,
        close: 141.877,
        volume: 327992,
      },
      {
        time: '2023.03.29 00:00',
        open: 141.879,
        low: 141.779,
        high: 144.09,
        close: 144.043,
        volume: 325102,
      },
      {
        time: '2023.03.30 00:00',
        open: 144.043,
        low: 143.125,
        high: 145.075,
        close: 144.645,
        volume: 318919,
      },
      {
        time: '2023.03.31 00:00',
        open: 144.639,
        low: 143.876,
        high: 145.668,
        close: 143.941,
        volume: 337673,
      },
      {
        time: '2023.04.03 00:00',
        open: 144.51,
        low: 143.615,
        high: 144.931,
        close: 144.201,
        volume: 338666,
      },
      {
        time: '2023.04.04 00:00',
        open: 144.221,
        low: 143.952,
        high: 145.43,
        close: 144.207,
        volume: 308277,
      },
      {
        time: '2023.04.05 00:00',
        open: 144.105,
        low: 142.664,
        high: 144.437,
        close: 143.06,
        volume: 285126,
      },
      {
        time: '2023.04.06 00:00',
        open: 143.04,
        low: 142.541,
        high: 143.993,
        close: 143.873,
        volume: 242832,
      },
      {
        time: '2023.04.07 00:00',
        open: 143.865,
        low: 143.402,
        high: 144.211,
        close: 144.101,
        volume: 191951,
      },
      {
        time: '2023.04.10 00:00',
        open: 143.92,
        low: 143.787,
        high: 145.146,
        close: 145.066,
        volume: 248259,
      },
      {
        time: '2023.04.11 00:00',
        open: 145.051,
        low: 144.867,
        high: 145.956,
        close: 145.816,
        volume: 246930,
      },
      {
        time: '2023.04.12 00:00',
        open: 145.816,
        low: 145.717,
        high: 146.657,
        close: 146.259,
        volume: 286399,
      },
      {
        time: '2023.04.13 00:00',
        open: 146.199,
        low: 146.068,
        high: 146.876,
        close: 146.423,
        volume: 306963,
      },
      {
        time: '2023.04.14 00:00',
        open: 146.412,
        low: 146.233,
        high: 147.15,
        close: 147.076,
        volume: 280111,
      },
      {
        time: '2023.04.17 00:00',
        open: 147.019,
        low: 146.655,
        high: 147.442,
        close: 146.835,
        volume: 240082,
      },
      {
        time: '2023.04.18 00:00',
        open: 146.835,
        low: 146.714,
        high: 147.374,
        close: 147.123,
        volume: 235340,
      },
      {
        time: '2023.04.19 00:00',
        open: 147.091,
        low: 146.996,
        high: 147.853,
        close: 147.535,
        volume: 252054,
      },
      {
        time: '2023.04.20 00:00',
        open: 147.533,
        low: 147.01,
        high: 147.823,
        close: 147.217,
        volume: 234032,
      },
      {
        time: '2023.04.21 00:00',
        open: 147.198,
        low: 146.393,
        high: 147.557,
        close: 147.412,
        volume: 252861,
      },
      {
        time: '2023.04.24 00:00',
        open: 147.203,
        low: 147.111,
        high: 148.463,
        close: 148.24,
        volume: 210024,
      },
      {
        time: '2023.04.25 00:00',
        open: 148.241,
        low: 146.281,
        high: 148.623,
        close: 146.683,
        volume: 262066,
      },
      {
        time: '2023.04.26 00:00',
        open: 146.68,
        low: 146.45,
        high: 147.906,
        close: 147.544,
        volume: 311781,
      },
      {
        time: '2023.04.27 00:00',
        open: 147.477,
        low: 147.132,
        high: 147.983,
        close: 147.632,
        volume: 260973,
      },
      {
        time: '2023.04.28 00:00',
        open: 147.627,
        low: 146.813,
        high: 150.426,
        close: 150.11,
        volume: 368884,
      },
      {
        time: '2023.05.01 00:00',
        open: 150.074,
        low: 150,
        high: 150.953,
        close: 150.886,
        volume: 229612,
      },
      {
        time: '2023.05.02 00:00',
        open: 150.886,
        low: 149.823,
        high: 151.607,
        close: 150.22,
        volume: 289979,
      },
      {
        time: '2023.05.03 00:00',
        open: 150.22,
        low: 148.949,
        high: 150.382,
        close: 148.949,
        volume: 317079,
      },
      {
        time: '2023.05.04 00:00',
        open: 148.962,
        low: 147.12,
        high: 149.194,
        close: 147.826,
        volume: 392560,
      },
      {
        time: '2023.05.05 00:00',
        open: 147.833,
        low: 147.679,
        high: 148.697,
        close: 148.579,
        volume: 280139,
      },
      {
        time: '2023.05.08 00:00',
        open: 148.529,
        low: 148.443,
        high: 149.259,
        close: 148.66,
        volume: 229079,
      },
      {
        time: '2023.05.09 00:00',
        open: 148.655,
        low: 147.879,
        high: 148.684,
        close: 148.203,
        volume: 259570,
      },
      {
        time: '2023.05.10 00:00',
        open: 148.202,
        low: 147.031,
        high: 148.66,
        close: 147.529,
        volume: 293442,
      },
      {
        time: '2023.05.11 00:00',
        open: 147.513,
        low: 146.124,
        high: 147.589,
        close: 146.847,
        volume: 313468,
      },
      {
        time: '2023.05.12 00:00',
        open: 146.847,
        low: 146.653,
        high: 147.464,
        close: 147.252,
        volume: 250152,
      },
      {
        time: '2023.05.15 00:00',
        open: 147.321,
        low: 147.183,
        high: 148.169,
        close: 148.001,
        volume: 232598,
      },
      {
        time: '2023.05.16 00:00',
        open: 148.001,
        low: 147.597,
        high: 148.491,
        close: 148.135,
        volume: 252039,
      },
      {
        time: '2023.05.17 00:00',
        open: 148.142,
        low: 148.049,
        high: 149.246,
        close: 149.209,
        volume: 259209,
      },
      {
        time: '2023.05.18 00:00',
        open: 149.202,
        low: 148.765,
        high: 149.442,
        close: 149.368,
        volume: 257374,
      },
      {
        time: '2023.05.19 00:00',
        open: 149.37,
        low: 148.705,
        high: 149.792,
        close: 149.057,
        volume: 291441,
      },
      {
        time: '2023.05.22 00:00',
        open: 149.016,
        low: 148.831,
        high: 149.916,
        close: 149.842,
        volume: 258863,
      },
      {
        time: '2023.05.23 00:00',
        open: 149.844,
        low: 149.093,
        high: 150.047,
        close: 149.246,
        volume: 281718,
      },
      {
        time: '2023.05.24 00:00',
        open: 149.243,
        low: 148.832,
        high: 149.929,
        close: 149.899,
        volume: 288736,
      },
      {
        time: '2023.05.25 00:00',
        open: 149.892,
        low: 149.281,
        high: 150.308,
        close: 150.177,
        volume: 296794,
      },
      {
        time: '2023.05.26 00:00',
        open: 150.131,
        low: 149.785,
        high: 150.806,
        close: 150.79,
        volume: 234650,
      },
    ];

    when(chartsFacade.getChartById(anything())).thenReturn(
      of(({ id: 'EURJPY', chart: chartsData }) as Chart )
    );


    await TestBed.configureTestingModule({
      declarations: [RatesChartsComponent],
      imports: [
        RouterTestingModule,
        NgxEchartsModule.forRoot({
          echarts: () => import('echarts'),
        })
      ],
      providers: [
        {
          provide: ChartsFacade,
          useFactory: () => instance(chartsFacade),
        },
      ],
    }).compileComponents();
  });

  beforeEach(() => {
    fixture = TestBed.createComponent(RatesChartsComponent);
    component = fixture.componentInstance;
    element = fixture.nativeElement;
  });

  it('should be created', () => {
    expect(component).toBeTruthy();
    expect(element).toBeTruthy();
    expect(() => fixture.detectChanges()).not.toThrow();
  });
  it('should display chart', () => {
    fixture.detectChanges();
    expect(element.querySelector('.demo-chart')).toBeTruthy();
  });
});
